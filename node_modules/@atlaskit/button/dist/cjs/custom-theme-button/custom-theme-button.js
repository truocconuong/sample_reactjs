"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var tslib_1 = require("tslib");
var react_1 = tslib_1.__importStar(require("react"));
var components_1 = tslib_1.__importDefault(require("@atlaskit/theme/components"));
var button_base_1 = tslib_1.__importDefault(require("../shared/button-base"));
var get_is_only_single_icon_1 = tslib_1.__importDefault(require("../shared/get-is-only-single-icon"));
var loading_spinner_1 = tslib_1.__importDefault(require("../shared/loading-spinner"));
var theme_1 = tslib_1.__importStar(require("./theme"));
function getInteractionState(_a) {
    var _b = _a.isDisabled, isDisabled = _b === void 0 ? false : _b, _c = _a.isActive, isActive = _c === void 0 ? false : _c, _d = _a.isFocus, isFocus = _d === void 0 ? false : _d, _e = _a.isHover, isHover = _e === void 0 ? false : _e, _f = _a.isSelected, isSelected = _f === void 0 ? false : _f, _g = _a.isLoading, isLoading = _g === void 0 ? false : _g;
    if (isDisabled) {
        return 'disabled';
    }
    if (isSelected && isFocus) {
        return 'focusSelected';
    }
    if (isSelected) {
        return 'selected';
    }
    // not allowing active or focus style changes while loading
    if (!isLoading && isActive) {
        return 'active';
    }
    if (!isLoading && isHover) {
        return 'hover';
    }
    if (isFocus) {
        return 'focus';
    }
    return 'default';
}
var initial = { isHover: false, isActive: false, isFocus: false };
var CustomThemeButton = react_1.default.memo(react_1.default.forwardRef(function CustomThemeButton(_a, ref) {
    var 
    // Calculate default props for use in custom themes
    _b = _a.appearance, 
    // Calculate default props for use in custom themes
    appearance = _b === void 0 ? 'default' : _b, _c = _a.autoFocus, autoFocus = _c === void 0 ? false : _c, _d = _a.isDisabled, isDisabled = _d === void 0 ? false : _d, _e = _a.isSelected, isSelected = _e === void 0 ? false : _e, _f = _a.shouldFitContainer, shouldFitContainer = _f === void 0 ? false : _f, _g = _a.spacing, spacing = _g === void 0 ? 'default' : _g, _h = _a.isLoading, isLoading = _h === void 0 ? false : _h, providedOnMouseEnter = _a.onMouseEnter, providedOnMouseLeave = _a.onMouseLeave, providedOnMouseDown = _a.onMouseDown, providedOnMouseUp = _a.onMouseUp, providedOnFocus = _a.onFocus, providedOnBlur = _a.onBlur, _j = _a.theme, theme = _j === void 0 ? theme_1.defaultThemeFn : _j, rest = tslib_1.__rest(_a, ["appearance", "autoFocus", "isDisabled", "isSelected", "shouldFitContainer", "spacing", "isLoading", "onMouseEnter", "onMouseLeave", "onMouseDown", "onMouseUp", "onFocus", "onBlur", "theme"]);
    // TODO is there a nicer way to do this?
    // Add default props back into object for spreading
    var restProps = tslib_1.__assign({ appearance: appearance,
        autoFocus: autoFocus,
        isDisabled: isDisabled,
        isSelected: isSelected,
        shouldFitContainer: shouldFitContainer,
        spacing: spacing }, rest);
    var _k = tslib_1.__read(react_1.useState(initial), 2), state = _k[0], setState = _k[1];
    var onMouseEnter = react_1.useCallback(function (event) {
        setState(function (current) { return (tslib_1.__assign(tslib_1.__assign({}, current), { isHover: true })); });
        if (providedOnMouseEnter) {
            providedOnMouseEnter(event);
        }
    }, [providedOnMouseEnter]);
    var onMouseLeave = react_1.useCallback(function (event) {
        setState(function (current) { return (tslib_1.__assign(tslib_1.__assign({}, current), { isHover: false, isActive: false })); });
        if (providedOnMouseLeave) {
            providedOnMouseLeave(event);
        }
    }, [providedOnMouseLeave]);
    var onMouseDown = react_1.useCallback(function (event) {
        setState(function (current) { return (tslib_1.__assign(tslib_1.__assign({}, current), { isActive: true })); });
        if (providedOnMouseDown) {
            providedOnMouseDown(event);
        }
    }, [providedOnMouseDown]);
    var onMouseUp = react_1.useCallback(function (event) {
        setState(function (current) { return (tslib_1.__assign(tslib_1.__assign({}, current), { isActive: false })); });
        if (providedOnMouseUp) {
            providedOnMouseUp(event);
        }
    }, [providedOnMouseUp]);
    var onFocus = react_1.useCallback(function (event) {
        setState(function (current) { return (tslib_1.__assign(tslib_1.__assign({}, current), { isFocus: true })); });
        if (providedOnFocus) {
            providedOnFocus(event);
        }
    }, [providedOnFocus]);
    var onBlur = react_1.useCallback(function (event) {
        setState(function (current) { return (tslib_1.__assign(tslib_1.__assign({}, current), { isFocus: false })); });
        if (providedOnBlur) {
            providedOnBlur(event);
        }
    }, [providedOnBlur]);
    return (react_1.default.createElement(theme_1.default.Provider, { value: theme },
        react_1.default.createElement(components_1.default.Consumer, null, function (_a) {
            var mode = _a.mode;
            return (react_1.default.createElement(theme_1.default.Consumer, tslib_1.__assign({ mode: mode, state: getInteractionState(tslib_1.__assign(tslib_1.__assign({}, state), { isLoading: isLoading, isSelected: restProps.isSelected, isDisabled: restProps.isDisabled })), iconIsOnlyChild: get_is_only_single_icon_1.default(restProps), isLoading: isLoading }, restProps), function (_a) {
                var buttonStyles = _a.buttonStyles;
                return (react_1.default.createElement(button_base_1.default, tslib_1.__assign({}, restProps, { ref: ref, overlay: isLoading ? react_1.default.createElement(loading_spinner_1.default, tslib_1.__assign({}, restProps)) : null, onMouseEnter: onMouseEnter, onMouseLeave: onMouseLeave, onMouseDown: onMouseDown, onMouseUp: onMouseUp, onFocus: onFocus, onBlur: onBlur, buttonCss: theme_1.getSpecifiers(buttonStyles) })));
            }));
        })));
}));
// Tools including enzyme rely on components having a display name
CustomThemeButton.displayName = 'CustomThemeButton';
exports.default = CustomThemeButton;
//# sourceMappingURL=custom-theme-button.js.map